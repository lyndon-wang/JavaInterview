# MySQL冷知识：t1.id=t2.id=t3.id看着咋这么怪呢？

标签： MySQL是怎样运行的

------

为了故事的顺利发展，我们先创建几个表：

```sql
CREATE TABLE t1 (id INT);
CREATE TABLE t2 (id INT);
CREATE TABLE t3 (id INT);
```

然后往这些表里插入一些数据（具体的插入语句就不写了），达到的效果就是这样：

```sql
mysql> SELECT * FROM t1;
+----+
| id |
+----+
|  1 |
|  2 |
|  3 |
+----+
3 rows in set (0.00 sec)

mysql> SELECT * FROM t2;
+----+
| id |
+----+
|  1 |
|  2 |
|  3 |
+----+
3 rows in set (0.00 sec)

mysql> SELECT * FROM t3;
+----+
| id |
+----+
|  1 |
|  2 |
|  3 |
+----+
3 rows in set (0.00 sec)
```

如果我们想对这三个表执行连接操作，把三个表中`id`列相同的记录都拿出来，有的同学可能会这样写：

```python
SELECT t1.id AS t1_id, t2.id AS t2_id, t3.id AS t3_id 
    FROM t1, t2, t3 
    WHERE t1.id = t2.id = t3.id;
```

这样写会得到啥效果呢？我们看一下：

```sql
mysql> SELECT t1.id AS t1_id, t2.id AS t2_id, t3.id AS t3_id
    ->     FROM t1, t2, t3
    ->     WHERE t1.id = t2.id = t3.id;
+-------+-------+-------+
| t1_id | t2_id | t3_id |
+-------+-------+-------+
|     1 |     1 |     1 |
|     2 |     2 |     1 |
|     3 |     3 |     1 |
+-------+-------+-------+
3 rows in set (0.00 sec)

mysql>
```

噫，发生了奇怪的事情，结果集中的第一条记录是符合我们预期的，但是剩下两条记录不符合我们预期，其中`t3.id`的值和`t1.id`、`t2.id`是不一样的，这是什么鬼呢？

哈哈，其实条件`t1.id = t2.id = t3.id`的真实含义是这样的：

```python
(t1.id = t2.id) = t3.id
```

也就是说我们需要分两步理解这个表达式：

- 先运算`t1.id = t2.id`，它其实是一个布尔表达式，得到的结果是0或者1。
- 上一步骤得到的结果（也就是0或者1）再和`t3.id`做比较。

让我们再分析一下上边的例子：

- 对于结果集的第一条记录来说，`t1.id`的值为1、`t2.id`的值为1、`t3.id`的值为1。
  - 先比较`t1.id = t2.id`是否成立，很显然`1 = 1`的结果是TRUE，MySQL中用1表示这个布尔表达式的结果。
  - 然后通过布尔表达式的结果`1`再和`t3.id`比较，很显然`1 = 1`成立。
- 对于结果集的第二条记录来说，`t1.id`的值为2、`t2.id`的值为2、`t3.id`的值为1。
  - 先比较`t1.id = t2.id`是否成立，很显然`2 = 2`的结果是TRUE，MySQL中用1表示这个布尔表达式的结果。
  - 然后通过布尔表达式的结果`1`再和`t3.id`比较，很显然`1 = 1`成立。
- 对于结果集的第三条记录来说，`t1.id`的值为3、`t2.id`的值为3、`t3.id`的值为1。
  - 先比较`t1.id = t2.id`是否成立，很显然`3 = 3`的结果是TRUE，MySQL中用1表示这个布尔表达式的结果。
  - 然后通过布尔表达式的结果`1`再和`t3.id`比较，很显然`1 = 1`成立。

噫，原来`t1.id = t2.id = t3.id`是这个意思呀，那我们想要实现把三个表中`id`列值相同的记录取出来的效果该咋写？这么写：

```python
SELECT t1.id AS t1_id, t2.id AS t2_id, t3.id AS t3_id 
    FROM t1, t2, t3 
    WHERE t1.id = t2.id AND t1.id = t3.id;
```

我们看下效果：

```python
mysql> SELECT t1.id AS t1_id, t2.id AS t2_id, t3.id AS t3_id
    ->     FROM t1, t2, t3
    ->     WHERE t1.id = t2.id AND t1.id = t3.id;
+-------+-------+-------+
| t1_id | t2_id | t3_id |
+-------+-------+-------+
|     1 |     1 |     1 |
|     2 |     2 |     2 |
|     3 |     3 |     3 |
+-------+-------+-------+
3 rows in set (0.00 sec)
```

这样的话，`MySQL`才会把三个表中`id`列值相同的记录取出来呢～ 一定要记住这个知识点喔，小心哪天写三表连接的时候写错了还找不到原因呢～

> 小贴士：
>
> 本文的这个问题是有《MySQL是怎样运行的：从根儿上理解MySQL》的微信讨论群里昵称为“白衬衫老胡同”的同学提问的，说实话我也把这个知识点忘掉了，在此感谢他的问题～